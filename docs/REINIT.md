# Re-initialization Safety

## Overview

Starting in v0.6.0, `npx telos-framework init` is **safe to run multiple times**
in the same project. The command detects existing Telos installations and offers
options to prevent accidental data loss.

## What Happens When You Re-run Init?

### 1. Detection Phase

The init command automatically scans for existing Telos installations by
checking:

**Command directories:**

- `.claude/commands/telos/` - Claude Code slash commands
- `.opencode/command/telos-*.md` - Opencode commands

**Configuration files:**

- `CLAUDE.md` - Contains "Telos Framework" reference
- `AGENTS.md` - Contains ".telos/TELOS.md" reference
- `.cursorrules` - Cursor configuration
- `.clinerules` - Cline configuration
- `.windsurfrules` - Windsurf configuration
- `.roocode` - Roo configuration
- `GEMINI.md` - Gemini configuration

### 2. User Prompt

If an existing installation is detected, you'll see:

```
⚠ Existing Telos installation detected

Detected platforms:
  - Claude Code
  - Cursor

? What would you like to do?
  ❯ Abort (keep existing installation)
    Reinstall (overwrite everything)
    Add platforms (keep existing, add new)
```

### 3. Three Options

#### Option 1: Abort (keep existing installation)

- **When to use**: You ran `init` by accident or just want to check status
- **What happens**: No changes made to any files
- **Safe**: ✅ 100% safe - nothing is modified

#### Option 2: Reinstall (overwrite everything)

- **When to use**: You want to start fresh or upgrade Telos framework files
- **What happens**: All slash commands and config files are regenerated
- **Warning**: ⚠️ Any customizations to generated files will be lost
- **Recommendation**: Commit your changes to git first

#### Option 3: Add platforms (keep existing, add new)

- **When to use**: You want to add support for additional AI assistants
- **What happens**: Only installs commands/configs for newly selected platforms
- **Safe**: ✅ Existing platforms are preserved
- **Example**: You have Claude Code installed and want to add Cursor

## Example Workflows

### Scenario 1: Accidental Re-run

```bash
$ npx telos-framework init

⚠ Existing Telos installation detected

Detected platforms:
  - Claude Code

? What would you like to do?
  ❯ Abort (keep existing installation)
    
✓ Installation cancelled. Existing files preserved.
```

### Scenario 2: Adding a New Platform

You initially installed for Claude Code, now want to add Cursor:

```bash
$ npx telos-framework init

⚠ Existing Telos installation detected

Detected platforms:
  - Claude Code

? What would you like to do?
    Add platforms (keep existing, add new)

Select additional platforms to install:

? Select platforms to add:
  ✔ Claude Code (already installed)
  ❯◉ Cursor
    ◯ Cline
    ◯ Windsurf
    
✓ Created .cursorrules
✓ Installation Complete!
```

### Scenario 3: Fresh Start After Customization

You customized `CLAUDE.md` but want to reinstall with latest framework updates:

```bash
# RECOMMENDED: Commit your changes first
$ git add CLAUDE.md
$ git commit -m "Save my Telos customizations"

$ npx telos-framework init

⚠ Existing Telos installation detected

? What would you like to do?
    Reinstall (overwrite everything)

⚠ Warning: This will overwrite all Telos files

# Your existing CLAUDE.md is now overwritten
# But you can restore your customizations from git:
$ git diff CLAUDE.md  # See what changed
$ git checkout CLAUDE.md  # Restore your version if needed
```

## What Gets Overwritten?

When you choose **Reinstall**, these files are regenerated:

### Slash Commands

- `.claude/commands/telos/*.md` (Claude Code)
- `.opencode/command/telos-*.md` (Opencode)

### Config Files

- `CLAUDE.md` (if Telos content exists)
- `AGENTS.md` (if Telos content exists)
- `.cursorrules`
- `.clinerules`
- `.windsurfrules`
- `.roocode`
- `GEMINI.md`

### Files NOT Touched

- `.telos/TELOS.md` - Generated by AI assistant, not by `init` command
- `.telos/agents/*.md` - Generated by AI assistant
- Any other project files

## Best Practices

### 1. Use Version Control

Always commit Telos files to git so you can track changes:

```bash
git add CLAUDE.md AGENTS.md .claude/ .opencode/
git commit -m "Initial Telos installation"
```

### 2. Customize After Installation

Don't manually edit generated slash command files
(`.claude/commands/telos/*.md`). These are meant to be regenerated. Instead:

- Customize `CLAUDE.md` or `AGENTS.md` (these can be preserved)
- Modify `.telos/TELOS.md` after AI generates it

### 3. Check Before Reinstalling

Run `git status` before choosing "Reinstall" to see if you have uncommitted
changes:

```bash
$ git status
modified:   CLAUDE.md    # You have customizations!
```

### 4. Use "Add platforms" for Multi-Platform

If you're setting up multiple AI assistants, install them one at a time or all
at once. You can always add more later with the "Add platforms" option.

## Technical Details

### Detection Logic

The `detectExistingInstallation()` function checks in this order:

1. **Command directories** - File system checks for slash command folders
2. **Config files** - Reads each config file and searches for:
   - String: `"Telos Framework"`
   - String: `".telos/TELOS.md"`

If either string is found in a config file, that platform is marked as detected.

### Platform Detection Accuracy

| Platform    | Detection Method                            | False Positive Risk |
| ----------- | ------------------------------------------- | ------------------- |
| Claude Code | `.claude/commands/telos/` exists            | Very Low            |
| Opencode    | `telos-*.md` files in `.opencode/command/`  | Very Low            |
| Cursor      | `.cursorrules` contains "Telos Framework"   | Low                 |
| Cline       | `.clinerules` contains "Telos Framework"    | Low                 |
| Windsurf    | `.windsurfrules` contains "Telos Framework" | Low                 |
| Roo         | `.roocode` contains "Telos Framework"       | Low                 |
| Gemini      | `GEMINI.md` contains "Telos Framework"      | Low                 |
| Other       | `AGENTS.md` contains "Telos Framework"      | Medium*             |

*Note: AGENTS.md might exist for other purposes. If you have a non-Telos
AGENTS.md file, the detection won't trigger unless it contains Telos-specific
strings.

## Migration from Earlier Versions

If you're upgrading from v0.5.0 or earlier:

1. **No action needed** - The new detection works automatically
2. **Safe to run** - `npx telos-framework init` will detect your existing
   installation
3. **Choose wisely** - Select "Reinstall" to get latest template updates, or
   "Abort" to keep your customizations

## Troubleshooting

### "Detected platforms" shows wrong platform

This can happen if:

- You manually created a config file with "Telos Framework" text
- You copied config files from another project

**Solution**: Choose "Reinstall" to clean up and regenerate correctly.

### I want to remove Telos completely

The `init` command doesn't provide an uninstall option. Manually delete:

```bash
rm -rf .claude/commands/telos/
rm -rf .opencode/command/telos-*.md
rm CLAUDE.md AGENTS.md  # Only if you want to remove these
rm .cursorrules .clinerules .windsurfrules .roocode GEMINI.md
# Optionally remove AI-generated files:
rm -rf .telos/
```

### Detection doesn't find my installation

If you installed Telos but detection doesn't work:

- Ensure config files actually contain "Telos Framework" text
- Check that slash command directories exist with correct names
- Run `ls -la .claude/commands/` to verify structure

## Testing

The re-initialization detection feature has comprehensive test coverage:

- **9 tests** in `test/reinit-detection.test.js`
- Tests cover: fresh install, Claude, Opencode, all platforms, edge cases
- **95 total tests** across the entire framework

Run tests:

```bash
npm test
```

## Future Enhancements

Potential improvements for future versions:

- Selective file reinstallation (e.g., "only update slash commands")
- Backup creation before overwriting
- Diff preview before reinstalling
- Migration scripts for breaking changes
- `telos upgrade` command separate from `init`
